<Window x:Class="ClioDataMigrator.View.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:ClioDataMigrator.ViewModels"
        xmlns:converters="clr-namespace:ClioDataMigrator.View.Converters"
        d:DataContext="{d:DesignInstance Type=vm:MainWindowViewModel}"
        mc:Ignorable="d"
        Title="Clio Data Migrator"
        Height="600"
        Width="800">

    <Grid Margin="10">

        <Grid.Resources>
            <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
            <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        </Grid.Resources>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <Label Grid.Row="0"
               Grid.Column="0"
               Content="Client ID:"
               VerticalAlignment="Center"/>
        <TextBox Grid.Row="0"
                 Grid.Column="1"
                 Margin="5"
                 Text="{Binding ClioClientId, UpdateSourceTrigger=PropertyChanged}"
                 IsReadOnly="True"/>
        <Label Grid.Row="1"
               Grid.Column="0"
               Content="Client Secret:"
               VerticalAlignment="Center"/>
        <PasswordBox x:Name="ClientSecretPasswordBox"
                     Grid.Row="1"
                     Grid.Column="1"
                     Margin="5"
                     IsEnabled="False"
                     PasswordChanged="ClientSecretPasswordBox_PasswordChanged"/>

        <Label Grid.Row="2"
               Grid.Column="0"
               Content="Redirect URI:"
               VerticalAlignment="Center"/>
        <TextBox Grid.Row="2"
                 Grid.Column="1"
                 Margin="5"
                 Text="{Binding RedirectUri, UpdateSourceTrigger=PropertyChanged}"
                 IsReadOnly="True"/>
        <StackPanel Grid.Row="3"
                    Grid.Column="1"
                    Orientation="Horizontal">
            <Button Margin="5"
                    Content="Desktop Auth"
                    Command="{Binding DesktopAuthenticateCommand}"
                    HorizontalAlignment="Left"/>
        </StackPanel>

        <!-- Desktop Authentication Section -->
        <Label Grid.Row="4"
               Grid.Column="0"
               Content="Auth Code:"
               VerticalAlignment="Center"/>
        <TextBox Grid.Row="4"
                 Grid.Column="1"
                 Margin="5"
                 Text="{Binding AuthorizationCode, UpdateSourceTrigger=PropertyChanged}"
                 ToolTip="Enter the authorization code from the Clio approval page"/>
        <Button Grid.Row="4"
                Grid.Column="2"
                Margin="5"
                Content="Process Code"
                Command="{Binding ProcessAuthCodeCommand}"/>
        <Label Grid.Row="5"
               Grid.Column="0"
               Content="File:"
               VerticalAlignment="Center"/>
        <TextBox Grid.Row="5"
                 Grid.Column="1"
                 Margin="5"
                 IsReadOnly="True"
                 Text="{Binding SourceFilePath}"/>
        <Button Grid.Row="5"
                Grid.Column="2"
                Margin="5"
                Content="Browse..."
                Command="{Binding SelectFileCommand}"/>

        <Label Grid.Row="6"
               Grid.Column="0"
               Content="Progress:"
               VerticalAlignment="Center"/>
        <ProgressBar Grid.Row="6"
                     Grid.Column="1"
                     Grid.ColumnSpan="2"
                     Margin="5"
                     Minimum="0"
                     Maximum="100"
                     Value="{Binding MigrationProgress}"/>
        <Label Grid.Row="7"
               Grid.Column="0"
               Content="Log:"
               VerticalAlignment="Top"/>
        <ListView Grid.Row="7"
                  Grid.Column="1"
                  Grid.ColumnSpan="2"
                  Margin="5"
                  ItemsSource="{Binding LogMessages}">
        </ListView>
        <StackPanel Grid.Row="8"
                    Grid.Column="0"
                    Grid.ColumnSpan="3"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,10,0,0">
            <TextBlock Text="{Binding ErrorMessage}"
                       Foreground="Red"
                       Margin="5"
                       Visibility="{Binding ErrorMessage, Converter={StaticResource NullToVisibilityConverter}}"/>
            <Label Content="Status:"
                   VerticalAlignment="Center"/>
            <Label Content="{Binding CurrentStatus}"
                   VerticalAlignment="Center"
                   FontWeight="Bold"/>
            <Button Content="Start process"
                    Margin="20,0,5,0"
                    Padding="10,5"
                    Command="{Binding StartMigrationCommand}"
                    IsEnabled="{Binding IsAuthenticated}">
                <Button.Style>
                    <Style TargetType="Button">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsBusy}"
                                         Value="True">
                                <Setter Property="IsEnabled"
                                        Value="False"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </StackPanel>

        <Border Grid.RowSpan="9"
                Grid.ColumnSpan="3"
                Background="#80000000"
                Visibility="{Binding IsBusy, Converter={StaticResource BoolToVisibility}}">
            <StackPanel HorizontalAlignment="Center"
                        VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True"
                             Width="200"
                             Height="20"/>
                <TextBlock Text="Working..."
                           Foreground="White"
                           HorizontalAlignment="Center"
                           Margin="0,10,0,0"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
